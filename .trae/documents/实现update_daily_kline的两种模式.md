# 实现update_daily_kline的两种模式

## 1. 恢复update_daily_kline方法的两种模式
- 修改`update_daily_kline`方法，添加`mode`参数支持
- 保留两种模式：`stock`模式和`date`模式
- `stock`模式：按股票查询近一年数据
- `date`模式：按日期爬取多个交易日所有股票的k线

## 2. 修改run_fetch.py脚本
- 恢复`--mode`参数支持
- 将`--mode`参数传递给`update_daily_kline`方法

## 3. 修改`_update_all_stocks_by_date`方法
- 保留按日期爬取的逻辑
- 在获取每个交易日的数据后，使用多线程并发调用`write_one`接口插入数据
- 确保每个股票数据单独调用`write_one`方法

## 4. 确保`daily_kline_storage_sqlite.py`的`write_one`方法能正确处理单条写入
- 确保`write_one`方法能处理单只股票的数据
- 确保`write_one`方法能处理按日期爬取的单只股票数据

## 5. 测试两种模式
- 测试`stock`模式能正常运行
- 测试`date`模式能正常运行，且能使用多线程并发插入数据

## 6. 确保代码符合项目规范
- 确保代码格式一致
- 确保日志记录完整
- 确保错误处理完善

## 7. 验证功能正确性
- 确保两种模式都能正确获取数据
- 确保数据能正确写入数据库
- 确保多线程并发插入能正常工作

## 8. 优化性能
- 确保`task_executor`和`io_executor`配置合理
- 确保线程数设置合理，避免API超限
- 确保写入性能优化

## 9. 确保代码可维护性
- 确保方法命名清晰
- 确保注释完整
- 确保代码结构合理

## 10. 确保与现有代码兼容
- 确保修改后的代码能与现有代码兼容
- 确保不破坏现有功能
- 确保不引入新的错误

## 11. 确保日志记录完整
- 确保两种模式的日志记录完整
- 确保错误日志记录清晰
- 确保进度日志记录完整

## 12. 确保错误处理完善
- 确保API调用错误能正确处理
- 确保数据库写入错误能正确处理
- 确保线程异常能正确处理

## 13. 确保代码符合项目规范
- 确保代码格式一致
- 确保命名规范
- 确保注释完整

## 14