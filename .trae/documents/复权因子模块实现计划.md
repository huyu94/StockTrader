# 复权因子模块实现计划

我们将采用与日历模块相似的架构，实现职责分离，并针对复权因子的大量股票特性，使用 CSV 文件作为缓存元数据存储。

## 1. 更新 `src/fetchers/adj_factor_fetcher.py`
- 修改 `fetch_one` 方法，使其在保存数据文件的同时，更新缓存 CSV。
- 实现 `_update_cache(ts_code, updated_at)` 方法：
    - 读取或创建 `cache/adj_factor_cache.csv`。
    - 字段包括：`ts_code`, `last_updated_at`。
    - 使用 pandas 高效处理更新。

## 2. 创建 `src/loaders/adj_factor_loader.py`
负责本地数据的读取与状态检查。
- **功能**：
    - `load(ts_code)`: 读取 `data/adj_factor/{ts_code}.csv`。
    - `check_update_needed(ts_code)`:
        - 读取 `cache/adj_factor_cache.csv`。
        - 检查 `ts_code` 是否存在且 `last_updated_at` 为今日。
        - 检查本地数据文件是否存在。

## 3. 创建 `src/managers/adj_factor_manager.py`
协调 Loader 和 Fetcher，对外提供统一接口。
- **功能**：
    - `get_adj_factor(ts_code)`:
        - 检查 loader 状态 -> 按需调用 fetcher -> 返回数据。
    - 支持批量检查或单只检查（初始阶段先实现单只）。

## 4. 测试
- 创建 `tests/test_adj_factor_manager.py`，验证自动更新逻辑和缓存 CSV 的读写正确性。
